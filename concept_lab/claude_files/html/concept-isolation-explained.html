<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concept Isolation Lab - Technical Deep Dive</title>
    <style>
        /* ===== CSS VARIABLES ===== */
        :root {
            /* Chinese Color Palette - Light Mode */
            --chinese-red: #8B0000;
            --chinese-gold: #FFD700;
            --jade-green: #00A86B;
            --ink-black: #2B2B2B;
            --paper-beige: #F5F5DC;
            --light-cream: #FAFAF0;

            /* Hierarchy Levels */
            --level-1: #000;
            --level-2: #333;
            --level-3: #666;
            --level-4: #999;
        }

        [data-theme="dark"] {
            /* Chinese Color Palette - Dark Mode */
            --chinese-red: #DC143C;
            --chinese-gold: #FFD700;
            --jade-green: #10B981;
            --ink-black: #E5E5DC;
            --paper-beige: #1A1A1A;
            --light-cream: #252525;

            /* Hierarchy Levels - Dark Mode */
            --level-1: #F5F5DC;
            --level-2: #D4C4B0;
            --level-3: #A89F91;
            --level-4: #6B6B6B;
        }

        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(135deg, var(--paper-beige) 0%, var(--light-cream) 100%);
            color: var(--ink-black);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.2;
        }

        .container {
            width: 100%;
            padding: 2px;
            margin: 0;
        }

        /* ===== TYPOGRAPHY ===== */
        h1 {
            font-size: 24px;
            font-weight: 900;
            margin: 4px 0;
            padding: 6px 4px;
            background: linear-gradient(135deg, var(--chinese-red), #CD5C5C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 18px;
            font-weight: 700;
            margin: 8px 0 4px 0;
            padding: 4px;
            border-left: 4px solid var(--chinese-red);
            background: rgba(139, 0, 0, 0.03);
            color: var(--level-1);
        }

        h3 {
            font-size: 14px;
            font-weight: 600;
            margin: 4px 0 2px 8px;
            color: var(--level-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        h4 {
            font-size: 12px;
            font-weight: 500;
            margin: 2px 0 1px 16px;
            color: var(--level-3);
        }

        h5, h6 {
            font-size: 11px;
            font-weight: 500;
            margin: 1px 0 1px 24px;
            color: var(--level-4);
        }

        /* ===== LAYOUT SYSTEMS ===== */
        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            width: 100%;
        }

        .two-column-layout.uneven {
            grid-template-columns: 2fr 1fr;
        }

        .two-column-layout.reverse-uneven {
            grid-template-columns: 1fr 2fr;
        }

        .dense-columns {
            column-count: 2;
            column-gap: 8px;
            column-fill: balance;
        }

        .compact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 4px;
            width: 100%;
        }

        /* ===== SECTIONS & CONTAINERS ===== */
        .primary-section {
            border: 2px solid var(--chinese-red);
            background: white;
            margin: 6px 0;
            padding: 6px;
        }

        .secondary-section {
            border-left: 3px solid var(--chinese-gold);
            background: rgba(255, 215, 0, 0.05);
            margin: 4px 0 4px 8px;
            padding: 4px;
        }

        .tertiary-section {
            margin-left: 16px;
            padding-left: 8px;
            border-left: 1px dashed #ccc;
        }

        .card {
            background: white;
            border: 1px solid rgba(139, 0, 0, 0.2);
            border-radius: 2px;
            padding: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card.priority {
            border: 2px solid var(--chinese-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), white);
        }

        .important-always-visible {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), white);
            border: 2px solid var(--chinese-gold);
            padding: 8px;
            margin: 8px 0;
            border-radius: 3px;
        }

        .important-always-visible h2 {
            color: var(--chinese-red);
            margin-top: 0;
        }

        /* ===== COLLAPSIBLES ===== */
        .collapsible {
            margin: 4px 0;
            width: 100%;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 6px 8px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05), rgba(255, 215, 0, 0.02));
            border-left: 3px solid var(--chinese-gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: all 0.2s ease;
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1), rgba(255, 215, 0, 0.05));
        }

        .collapsible-header .arrow {
            display: inline-block;
            transition: transform 0.3s ease;
            color: var(--chinese-red);
            font-size: 10px;
        }

        .collapsible.open .arrow {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 8px;
            margin-left: 12px;
        }

        .collapsible.open .collapsible-content {
            max-height: 5000px;
            padding: 8px;
        }

        .two-column-layout .collapsible {
            grid-column: span 1;
        }

        .two-column-layout .collapsible.full-width {
            grid-column: span 2;
        }

        .collapsible.critical .collapsible-header {
            border-left: 4px solid var(--chinese-red);
            background: rgba(139, 0, 0, 0.08);
            font-weight: 700;
        }

        .collapsible.secondary .collapsible-header {
            border-left: 2px solid #999;
            background: rgba(0, 0, 0, 0.02);
            font-size: 13px;
        }

        /* ===== LISTS ===== */
        .dense-list {
            list-style: none;
            padding: 0;
            margin-left: 8px;
        }

        .dense-list li {
            padding: 2px 0 2px 12px;
            border-left: 2px solid transparent;
            position: relative;
        }

        .dense-list li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: var(--chinese-red);
            font-size: 10px;
        }

        .dense-list li strong {
            color: var(--level-2);
            font-weight: 600;
        }

        /* ===== CODE BLOCKS ===== */
        code {
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.3), rgba(255, 255, 255, 0.5));
            border: 1px solid rgba(139, 0, 0, 0.1);
            padding: 2px 4px;
            margin: 0 1px;
            font-family: 'Monaco', 'Menlo', 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.1;
            border-radius: 2px;
        }

        pre {
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.3), rgba(255, 255, 255, 0.5));
            border: 1px solid rgba(139, 0, 0, 0.1);
            padding: 6px 8px;
            margin: 4px 0;
            font-family: 'Monaco', 'Menlo', 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
            tab-size: 4;
            -moz-tab-size: 4;
            border-radius: 3px;
        }

        pre code {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-size: inherit;
            line-height: inherit;
            white-space: inherit;
        }

        /* ===== TABLES ===== */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 4px 0;
            font-size: 12px;
        }

        th {
            background: var(--chinese-red);
            color: white;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 3px 6px;
        }

        td {
            border: 1px solid #ddd;
            padding: 3px 6px;
            text-align: left;
        }

        tr:nth-child(even) {
            background: rgba(0,0,0,0.02);
        }

        td:first-child {
            font-weight: 600;
            color: var(--level-2);
        }

        /* ===== BUTTONS ===== */
        button, .button {
            background: linear-gradient(135deg, var(--chinese-red), #CD5C5C);
            color: white;
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.2s ease;
            padding: 2px 6px;
            margin: 1px;
            font-size: 12px;
            line-height: 1.1;
            cursor: pointer;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(139, 0, 0, 0.3);
            border-color: var(--chinese-gold);
        }

        #theme-toggle {
            position: fixed;
            top: 8px;
            right: 8px;
            z-index: 10000;
            background: var(--chinese-gold);
            color: var(--ink-black);
            border: 2px solid var(--chinese-red);
            padding: 4px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        #theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* ===== UTILITY CLASSES ===== */
        .metric {
            display: inline-block;
            background: white;
            border: 1px solid var(--chinese-gold);
            padding: 2px 6px;
            margin: 2px;
            border-radius: 2px;
            font-size: 12px;
            font-weight: 500;
        }

        .metric.important {
            background: var(--chinese-gold);
            color: white;
            font-weight: 700;
        }

        .critical { color: var(--chinese-red); font-weight: 700; }
        .success { color: var(--jade-green); font-weight: 600; }
        .warning { color: var(--chinese-gold); font-weight: 600; }
        .muted { color: var(--level-4); font-size: 11px; }
        .highlight { background: rgba(255, 215, 0, 0.2); padding: 1px 2px; }

        .indent-1 { margin-left: 12px; }
        .indent-2 { margin-left: 24px; }
        .indent-3 { margin-left: 36px; }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, var(--chinese-red), transparent);
            margin: 8px 0;
        }

        blockquote {
            margin: 2px 0;
            padding: 2px 8px;
            border-left: 2px solid var(--chinese-red);
        }

        hr {
            margin: 2px 0;
            border: none;
            height: 1px;
            background: var(--chinese-red);
        }

        /* ===== DARK MODE OVERRIDES ===== */
        [data-theme="dark"] code {
            background: rgba(40, 40, 40, 0.8);
            border-color: #555;
            color: #e0e0e0;
        }

        [data-theme="dark"] pre {
            background: rgba(30, 30, 30, 0.9);
            border-color: #555;
            color: #e0e0e0;
        }

        [data-theme="dark"] .requirement,
        [data-theme="dark"] .feature-list li,
        [data-theme="dark"] .column,
        [data-theme="dark"] .metric,
        [data-theme="dark"] td {
            background: var(--light-cream);
            color: var(--ink-black);
        }

        [data-theme="dark"] .secondary-section {
            background: rgba(255, 215, 0, 0.08);
        }

        [data-theme="dark"] td {
            border-color: #444;
        }

        [data-theme="dark"] tr:nth-child(even) td {
            background: rgba(255, 215, 0, 0.05);
        }

        [data-theme="dark"] th {
            background: rgba(220, 20, 60, 0.1);
        }

        /* ===== MERMAID DIAGRAM STYLING ===== */
        .diagram-container {
            background: white;
            border: 1px solid #D1D5DB;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        .mermaid {
            background: linear-gradient(135deg, #F5F0E8 0%, #EDE8DC 100%);
            padding: 20px;
            margin: 8px 0;
            border-radius: 4px;
            border: 1px solid #D4C4B0;
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        [data-theme="dark"] .diagram-container {
            background: #2a2a2a;
            border-color: #444;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        [data-theme="dark"] .mermaid {
            background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
            border-color: #444;
        }

        /* ===== IMAGE COMPARISON STYLES ===== */
        .image-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 16px 0;
        }

        .image-panel {
            text-align: center;
        }

        .image-panel img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .image-panel .label {
            margin-top: 8px;
            font-weight: 600;
            color: var(--level-2);
        }

        .image-panel .caption {
            font-size: 12px;
            color: var(--level-3);
            margin-top: 4px;
        }

        .concept-row {
            background: white;
            border: 1px solid rgba(139, 0, 0, 0.15);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }

        [data-theme="dark"] .concept-row {
            background: var(--light-cream);
        }

        .concept-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .concept-type {
            background: var(--chinese-red);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .concept-name {
            font-weight: 700;
            font-size: 16px;
            color: var(--level-1);
        }

        .prompt-box {
            background: rgba(0,0,0,0.03);
            border-left: 3px solid var(--chinese-gold);
            padding: 8px 12px;
            margin: 8px 0;
            font-family: 'Monaco', monospace;
            font-size: 11px;
            white-space: pre-wrap;
        }

        [data-theme="dark"] .prompt-box {
            background: rgba(255,255,255,0.05);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .dense-columns { column-count: 2; }
        }

        @media (max-width: 800px) {
            .dense-columns { column-count: 1; }
            .two-column-layout,
            .two-column-layout.uneven,
            .two-column-layout.reverse-uneven {
                grid-template-columns: 1fr;
            }
            .image-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <button id="theme-toggle">üåô Dark</button>

    <div class="container">
        <h1>Concept Isolation Lab v2.0</h1>
        <p class="muted" style="margin-bottom: 16px;">Extract design dimensions from images ‚Üí Generate pure concept references</p>

        <!-- HOOK: The Takeaway -->
        <div class="important-always-visible">
            <h2>The Core Idea</h2>
            <p><strong>Take any image ‚Üí AI suggests design dimensions OR you specify what to extract ‚Üí Generate pure concept swatches.</strong></p>
            <ul class="dense-list">
                <li><strong>Goal:</strong> Isolate specific design dimensions (lighting, texture, mood, contrast) as reusable references</li>
                <li><strong>Two Modes:</strong> Auto-suggest (Gemini proposes 4-5 interesting dimensions) OR User-specified (you choose the axes)</li>
                <li><strong>Result:</strong> Abstract "design swatches" that embody each dimension, ready for inspiration or style transfer</li>
            </ul>
        </div>

        <!-- ARCHITECTURE DIAGRAM -->
        <h2>How It Works</h2>
        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    IMG[Source Image] --> CHOICE{Mode?}

    CHOICE -->|Auto-Suggest| ANALYZE[Gemini Flash<br/>Analyze & Suggest<br/>4-5 Dimensions]
    CHOICE -->|User-Specified| EXTRACT[Gemini Flash<br/>Extract Specified<br/>Dimensions]

    ANALYZE --> DIMS[Design Dimensions<br/>name, tags, description]
    EXTRACT --> DIMS

    DIMS --> GEN[Gemini Pro Image<br/>Generate Concept]
    GEN --> OUTPUT[Pure Concept<br/>Images]
            </div>
        </div>

        <div class="secondary-section">
            <h3>Two Operating Modes</h3>
            <div class="two-column-layout">
                <div class="card">
                    <h4>Mode 1: Auto-Suggest</h4>
                    <p>Hand in an image and let Gemini analyze it to suggest 4-5 interesting design dimensions. Great for discovery‚Äîthe AI identifies what's visually distinctive about your image.</p>
                    <div class="prompt-box">POST /api/isolate-concepts
{
  "image_base64": "...",
  "count": 5,           // suggest 5 dimensions
  "generate_images": true
}</div>
                </div>
                <div class="card">
                    <h4>Mode 2: User-Specified</h4>
                    <p>You know exactly what dimensions you want to extract (e.g., "lighting" and "texture"). The system extracts just those specific design axes from your image.</p>
                    <div class="prompt-box">POST /api/isolate-concepts
{
  "image_base64": "...",
  "dimensions": ["texture", "contrast"],
  "generate_images": true
}</div>
                </div>
            </div>
        </div>

        <hr style="margin: 24px 0;">

        <!-- RESULTS: Image Comparisons -->
        <h2>Results: Original ‚Üí Generated Concepts</h2>

        <!-- Concept 1: Lighting -->
        <div class="concept-row">
            <div class="concept-header">
                <span class="concept-type">Lighting</span>
                <span class="concept-name">Chiaroscuro Glow</span>
            </div>
            <div class="image-comparison">
                <div class="image-panel">
                    <img src="images/3b1dbba4-2896-4dce-803c-0003e1f84a6e.jpg" alt="Original: Hands holding glowing sphere">
                    <div class="label">Original Image</div>
                    <div class="caption">Hands cupping a luminous sphere against darkness</div>
                </div>
                <div class="image-panel">
                    <img src="images/concept-43b9554d.jpg" alt="Generated: Pure lighting concept">
                    <div class="label">Generated Concept</div>
                    <div class="caption">Pure embodiment of the soft chiaroscuro lighting</div>
                </div>
            </div>
            <div class="collapsible" data-collapsible="closed">
                <div class="collapsible-header">
                    <span>View extracted concept description</span>
                    <span class="arrow">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <div class="prompt-box">Soft, warm central light source creating a gentle glow that diffuses outward into deep shadows. The lighting exhibits classic chiaroscuro technique - dramatic contrast between the illuminated focal point and the surrounding darkness. The light has an ethereal, almost spiritual quality, suggesting inner luminescence rather than harsh external lighting. Smooth falloff from bright center to velvety black edges creates depth and dimensionality. The interplay of light and shadow suggests mystery, intimacy, and revelation.</div>
                </div>
            </div>
        </div>

        <!-- Concept 2: Mood -->
        <div class="concept-row">
            <div class="concept-header">
                <span class="concept-type">Mood</span>
                <span class="concept-name">Wong Kar-wai Melancholia</span>
            </div>
            <div class="image-comparison">
                <div class="image-panel">
                    <img src="images/a93ca773-f513-412a-8f71-f971282b248c.jpg" alt="Original: Wong Kar-wai style portrait">
                    <div class="label">Original Image</div>
                    <div class="caption">Green-tinted, rain-soaked urban portrait</div>
                </div>
                <div class="image-panel">
                    <img src="images/concept-667d66a8.jpg" alt="Generated: Pure mood concept">
                    <div class="label">Generated Concept</div>
                    <div class="caption">Abstract representation of urban melancholia</div>
                </div>
            </div>
            <div class="collapsible" data-collapsible="closed">
                <div class="collapsible-header">
                    <span>View extracted concept description</span>
                    <span class="arrow">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <div class="prompt-box">Deep, saturated green-blue tonal palette with hints of neon warmth bleeding through. The mood is distinctly melancholic yet seductive - a sense of urban loneliness intertwined with romantic longing. Rain-streaked, dreamlike atmosphere with soft focus creating emotional distance. Strong association with night, wet city streets, and the isolation of being surrounded by people yet alone. The color grading suggests both nostalgia and present-tense yearning. Cinematic quality evokes late-night contemplation and bittersweet memory.</div>
                </div>
            </div>
        </div>

        <!-- Concept 3: General Aesthetic -->
        <div class="concept-row">
            <div class="concept-header">
                <span class="concept-type">General</span>
                <span class="concept-name">Ethereal Minimalism</span>
            </div>
            <div class="image-comparison">
                <div class="image-panel">
                    <img src="images/3b1dbba4-2896-4dce-803c-0003e1f84a6e.jpg" alt="Original: Same hands/sphere image">
                    <div class="label">Original Image</div>
                    <div class="caption">Same source, different concept type</div>
                </div>
                <div class="image-panel">
                    <img src="images/concept-876792b5.jpg" alt="Generated: General aesthetic">
                    <div class="label">Generated Concept</div>
                    <div class="caption">Overall aesthetic: centered, minimal, spiritual</div>
                </div>
            </div>
            <div class="collapsible" data-collapsible="closed">
                <div class="collapsible-header">
                    <span>View extracted concept description</span>
                    <span class="arrow">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <div class="prompt-box">Extreme minimalism with a single point of interest dominating the frame. The aesthetic is meditative and contemplative - suggesting ritual, offering, or sacred geometry. Perfect symmetry and centered composition create stability and focus. The overall feeling is one of quiet reverence, intimate scale against infinite darkness. Human presence implied through organic forms but abstracted beyond recognition. The design language speaks to universal themes: light vs. dark, giving vs. receiving, the finite holding the infinite.</div>
                </div>
            </div>
        </div>

        <hr style="margin: 24px 0;">

        <!-- TECHNICAL DETAILS -->
        <h2>Technical Implementation</h2>

        <div class="two-column-layout">
            <div class="card">
                <h3>Backend (concept_server.py)</h3>
                <ul class="dense-list">
                    <li><strong>Port 8766</strong> - Separate from main Pageant (8765)</li>
                    <li><strong>Gemini 2.0 Flash</strong> - Vision analysis for dimension extraction</li>
                    <li><strong>Gemini 3 Pro Image</strong> - Concept image generation</li>
                    <li><strong>FastAPI</strong> - REST API with async support</li>
                </ul>
                <pre><code>GET  /api/axes             - List design axes
POST /api/analyze-dimensions - Auto-suggest dimensions
POST /api/extract-dimension  - Extract specific axis
POST /api/generate-concept   - Generate concept image
POST /api/isolate-concepts   - Full pipeline</code></pre>
            </div>
            <div class="card">
                <h3>Design Axes (from Pageant)</h3>
                <ul class="dense-list">
                    <li><strong>Known:</strong> colors, composition, mood, layout, aesthetic, typeface_feel</li>
                    <li><strong>Extended:</strong> lighting, texture, rhythm, depth, contrast, materiality, atmosphere</li>
                    <li><strong>Custom:</strong> Any axis name you want!</li>
                </ul>
                <p class="muted" style="margin-top: 8px;">Each dimension includes: name, description, tags, and generation prompt</p>
            </div>
        </div>

        <div class="collapsible" data-collapsible="closed">
            <div class="collapsible-header">
                <span>Segmentation Models Compared</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <table>
                    <tr>
                        <th>Model</th>
                        <th>Input Type</th>
                        <th>Best For</th>
                        <th>Browser Support</th>
                    </tr>
                    <tr>
                        <td>CLIPSeg</td>
                        <td>Text prompt</td>
                        <td>Describable concepts ("the lighting", "red areas")</td>
                        <td>‚úì via transformers.js</td>
                    </tr>
                    <tr>
                        <td>SAM</td>
                        <td>Point/box click</td>
                        <td>Precise object boundaries when pointing works</td>
                        <td>‚úì via transformers.js</td>
                    </tr>
                    <tr>
                        <td>SAM 3</td>
                        <td>Concept prompt</td>
                        <td>Finding ALL instances of a concept (future ideal)</td>
                        <td>Not yet (Meta Nov 2025)</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="collapsible" data-collapsible="closed">
            <div class="collapsible-header">
                <span>API Code Examples (v2.0)</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <pre><code>import httpx
import base64

# Mode 1: Auto-suggest dimensions
async def auto_suggest(image_path: str, count: int = 5):
    with open(image_path, "rb") as f:
        image_b64 = base64.b64encode(f.read()).decode()

    response = await httpx.post(
        "http://localhost:8766/api/isolate-concepts",
        json={
            "image_base64": image_b64,
            "count": count,           # AI suggests N dimensions
            "generate_images": True
        }
    )
    # Returns: { "mode": "auto_suggested", "concepts": [...] }

# Mode 2: User-specified dimensions
async def extract_specific(image_path: str, axes: list[str]):
    with open(image_path, "rb") as f:
        image_b64 = base64.b64encode(f.read()).decode()

    response = await httpx.post(
        "http://localhost:8766/api/isolate-concepts",
        json={
            "image_base64": image_b64,
            "dimensions": axes,       # e.g., ["texture", "contrast"]
            "generate_images": True
        }
    )
    # Returns: { "mode": "user_specified", "concepts": [...] }

# Each concept contains:
# {
#   "dimension": { "axis", "name", "description", "tags", "generation_prompt" },
#   "image_base64": "...",
#   "image_id": "concept-xxx.jpg"
# }</code></pre>
            </div>
        </div>

        <hr style="margin: 24px 0;">

        <!-- V2.0 TEST RESULTS -->
        <h2>v2.0 Test Results: User-Specified Mode</h2>
        <p class="muted" style="margin-bottom: 12px;">Extracting "texture" and "contrast" from a grainy B&W portrait</p>

        <div class="concept-row">
            <div class="concept-header">
                <span class="concept-type">Texture</span>
                <span class="concept-name">Grainy Sensual Touch</span>
            </div>
            <div class="image-comparison">
                <div class="image-panel">
                    <img src="images/03e31479-45c8-40a8-954b-646feed6f3c0.jpg" alt="Original: B&W grainy portrait">
                    <div class="label">Original Image</div>
                    <div class="caption">Dramatic B&W portrait with heavy film grain</div>
                </div>
                <div class="image-panel">
                    <img src="images/concept-517e8af6.jpg" alt="Generated: Pure texture concept">
                    <div class="label">Generated Concept</div>
                    <div class="caption">Pure film grain texture abstraction</div>
                </div>
            </div>
            <div class="collapsible" data-collapsible="closed">
                <div class="collapsible-header">
                    <span>View extracted dimension</span>
                    <span class="arrow">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <p><strong>Tags:</strong> grainy, soft, high-contrast</p>
                    <div class="prompt-box">The texture is characterized by a juxtaposition of rough, grainy areas and softer, blurred regions. This creates a tactile quality, evoking the feel of worn film stock or a soft, intimate touch. The interplay enhances the emotional depth of the image.</div>
                </div>
            </div>
        </div>

        <div class="concept-row">
            <div class="concept-header">
                <span class="concept-type">Contrast</span>
                <span class="concept-name">Ethereal Dark Variance</span>
            </div>
            <div class="image-comparison">
                <div class="image-panel">
                    <img src="images/03e31479-45c8-40a8-954b-646feed6f3c0.jpg" alt="Original: Same B&W portrait">
                    <div class="label">Original Image</div>
                    <div class="caption">Same source, different dimension</div>
                </div>
                <div class="image-panel">
                    <img src="images/concept-e1aa21c7.jpg" alt="Generated: Pure contrast concept">
                    <div class="label">Generated Concept</div>
                    <div class="caption">Pure high-contrast flowing forms</div>
                </div>
            </div>
            <div class="collapsible" data-collapsible="closed">
                <div class="collapsible-header">
                    <span>View extracted dimension</span>
                    <span class="arrow">‚ñ∂</span>
                </div>
                <div class="collapsible-content">
                    <p><strong>Tags:</strong> high-contrast, dramatic, monochromatic</p>
                    <div class="prompt-box">The image displays a striking contrast between areas of deep shadow and bright highlight, creating a dramatic interplay of light and dark. The high contrast emphasizes form and shape while the monochromatic palette adds to the emotional intensity.</div>
                </div>
            </div>
        </div>

        <!-- NEXT STEPS -->
        <div class="card priority" style="margin-top: 24px;">
            <h3>Next Steps</h3>
            <ol class="dense-list" style="margin-left: 0;">
                <li style="margin-bottom: 8px;"><strong>Try the API:</strong> <code>curl http://localhost:8766/docs</code> for interactive Swagger docs</li>
                <li style="margin-bottom: 8px;"><strong>Experiment with axes:</strong> Try custom dimensions like "rhythm", "materiality", "atmosphere"</li>
                <li style="margin-bottom: 8px;"><strong>Integrate into Pageant:</strong> Add concept isolation as a feature for any saved image</li>
            </ol>
        </div>

    </div>

    <!-- Mermaid.js (only include if using diagrams) -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ===== DARK MODE SETUP =====
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
                themeToggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    this.textContent = newTheme === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
                });
            }

            // ===== MERMAID SETUP =====
            const currentTheme = localStorage.getItem('theme') || 'light';

            mermaid.initialize({
                startOnLoad: true,
                theme: currentTheme === 'dark' ? 'dark' : 'base',
                themeVariables: currentTheme === 'dark' ? {
                    background: '#1e1e1e',
                    primaryColor: '#bb86fc',
                    primaryTextColor: '#e0e0e0',
                    primaryBorderColor: '#bb86fc',
                    lineColor: '#888',
                    secondaryColor: '#03dac6',
                    tertiaryColor: '#cf6679',
                    mainBkg: '#2a2a2a',
                    textColor: '#e0e0e0',
                    nodeBorder: '#888',
                    actorBkg: '#3a3a3a',
                    actorBorder: '#888',
                    actorTextColor: '#e0e0e0',
                    signalColor: '#e0e0e0',
                    signalTextColor: '#e0e0e0',
                    labelBoxBkgColor: '#bb86fc',
                    labelTextColor: '#000',
                    noteBkgColor: '#3a3a3a',
                    noteTextColor: '#e0e0e0',
                    noteBorderColor: '#888',
                    fontSize: '14px',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif'
                } : {
                    background: '#F5F0E8',
                    primaryColor: '#7A1712',
                    primaryTextColor: '#1a1a1a',
                    primaryBorderColor: '#6B4423',
                    lineColor: '#4A5568',
                    secondaryColor: '#1B3A57',
                    tertiaryColor: '#2D5016',
                    mainBkg: '#EDE8DC',
                    textColor: '#1a1a1a',
                    nodeBorder: '#6B4423',
                    actorBkg: '#D4C4B0',
                    actorBorder: '#6B4423',
                    actorTextColor: '#1a1a1a',
                    actorLineColor: '#6B4423',
                    signalColor: '#1a1a1a',
                    signalTextColor: '#1a1a1a',
                    labelBoxBkgColor: '#7A1712',
                    labelBoxBorderColor: '#6B4423',
                    labelTextColor: '#fff',
                    loopTextColor: '#1a1a1a',
                    noteBkgColor: '#FEF3C7',
                    noteTextColor: '#6B4423',
                    noteBorderColor: '#D97706',
                    activationBorderColor: '#6B4423',
                    activationBkgColor: '#D4C4B0',
                    labelColor: '#1a1a1a',
                    classText: '#1a1a1a',
                    fontSize: '14px',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif'
                },
                flowchart: {
                    curve: 'basis',
                    padding: 20,
                    useMaxWidth: true,
                    htmlLabels: true
                },
                sequence: {
                    actorMargin: 50,
                    diagramMarginX: 8,
                    diagramMarginY: 8,
                    useMaxWidth: true
                }
            });

            // ===== COLLAPSIBLES SETUP =====
            document.querySelectorAll('[data-collapsible]').forEach(function(section) {
                const isOpen = section.getAttribute('data-collapsible') === 'open';
                section.classList.add('collapsible');
                if (isOpen) section.classList.add('open');
            });

            document.querySelectorAll('.collapsible-header').forEach(function(header) {
                header.addEventListener('click', function() {
                    const collapsible = this.closest('.collapsible');
                    collapsible.classList.toggle('open');
                });
            });

            // ===== EXPAND/COLLAPSE ALL =====
            const expandAllBtn = document.getElementById('expand-all');
            const collapseAllBtn = document.getElementById('collapse-all');

            if (expandAllBtn) {
                expandAllBtn.addEventListener('click', function() {
                    document.querySelectorAll('.collapsible').forEach(function(c) {
                        c.classList.add('open');
                    });
                });
            }

            if (collapseAllBtn) {
                collapseAllBtn.addEventListener('click', function() {
                    document.querySelectorAll('.collapsible').forEach(function(c) {
                        c.classList.remove('open');
                    });
                });
            }
        });
    </script>
</body>
</html>
